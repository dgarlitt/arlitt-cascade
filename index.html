<!DOCTYPE html>
<html>
    <head>
        <title>Test</title>
        <link rel="stylesheet" href="assets/css/ui-lightness/jquery-ui-1.8.17.custom.css" />
        <script type="text/javascript" src="assets/js/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="assets/js/jquery-ui-1.8.17.custom.min.js"></script>
        <script type="text/javascript">
            
            (function($, undefined) {
                
                $.widget('arlitt.cascade', {
                    /*** public properties ***/
                    options: {
                        action: function(e) {
                            alert( 'hello' );
                        },
                        group: 'default',
                        event: 'change'
                    },
                    /*** private properties ***/
                    // private properties go here
                    /*** public methods ***/
                    // public methods go here
                    /*** private methods ***/
                    _create: function() {
                        var instances = $.arlitt.cascade.instances;
                        var self = this;
                        
                        if ( !instances[this.options.group]) {
                            instances[this.options.group] = [];
                        }
                        
                        // set the index of the element in the group
                        this.options.index = instances[this.options.group].length;
                        
                        //if ( !this.options.triggeredBy ) {
                            // if an option wasn't explicitly set
                            // for the triggering element, then
                            // use the last one added to the
                            // cascade array
                            if ( instances[this.options.group].length > 0 ) {
                                this.triggeredBy = instances[this.options.group][instances[this.options.group].length-1];
                            } else if ( this.options.startElement ) {
                                this.triggeredBy = this.options.startElement;
                            }
                        //}
                        
                        // add this element to the array of cascade instances
                        instances[this.options.group].push(this.element);
                        
                        if ( this.triggeredBy ) {
                            this.triggeredBy.on(this.options.event + '.arlittcascade', function(e) {
                                self.options.action(self.element, self.triggeredBy, e);
                            });
                        }
                        
                        if ( console ) {
                            console.info( this.element.attr('name') + ' of group "' + this.options.group + '" is triggered by ' + ((!this.triggeredBy) ? 'nothing' : this.triggeredBy.attr('name')) );
                        }
                    },
                    _setOption: function(key, value) {
                        // Handle the option change and then
                       $.Widget.prototype._setOption.call(this, key, value);
                    }
                });
                
                $.extend($.arlitt.cascade, {
                    instances: {}
                });
                
            })(jQuery);
            
            $(function(){
                
                var cascadeAjax = function( targetEl, sourceEl ) {
                    
                    var sourceData = '';
                    var ajaxURL = 'json/' + targetEl.attr('name') + '.json';
                    
                    if ( sourceEl ) {
                        sourceData = sourceEl.find(':selected').val();
                        ajaxURL = ajaxURL.replace('.json', sourceData + '.json')
                    }
                    
                    $.ajax({
                       
                       url: ajaxURL,
                       data: sourceData,
                       cache: false,
                       dataType: 'json',
                       error: function(jqXHR, textStatus, errorThrown) {
                           console.log('error: ' + errorThrown);
                       },
                       beforeSend: function() {
                            targetEl.empty().trigger('change');
                       },
                       success: function(data) {
                            targetEl
                                .append('<option value="">- ALL -</option>');
                           for ( var i in data ) {
                               targetEl.append('<option value="' + data[i][0] + '">' + data[i][1] + '</option>')
                           }
                       }
                       
                   });
               }
                
                cascadeAjax( $('select[name="state"]') );
                $('div#group1 select').cascade({ action: cascadeAjax, group: 'group1' });
                $('div#group2 select').cascade({ action: cascadeAjax, group: 'group2', startElement: $('div#group1 select[name="state"]') });
               
            });
            
        </script>
    </head>
    
    <body>
        <div id="group1">
            <select name="state"></select>
            <select name="county"></select>
            <select name="city"></select>
            <select name="person"></select>
        </div>
        
        <div id="group2">
            <select name="county"></select><br />
            <select name="city"></select><br />
            <select name="peerson"></select><br />
        </div>
    </body>
</html>